# Assignment 5: Multi-Class Classification â€“ Wine Dataset

import numpy as np
import matplotlib.pyplot as plt
from sklearn.datasets import load_wine
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import classification_report, confusion_matrix, accuracy_score
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from imblearn.over_sampling import SMOTE  # pip install imbalanced-learn

# 1. Load dataset
wine = load_wine()
X = wine.data
y = wine.target
class_names = wine.target_names

print("Class counts:", np.bincount(y))

# 2. Train/test split with stratify
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# 3. Handle imbalance (here wine is fairly balanced, but we show SMOTE)
smote = SMOTE(random_state=42)
X_train_res, y_train_res = smote.fit_resample(X_train, y_train)

# 4. Scaling (good for LR)
scaler = StandardScaler()
X_train_res_scaled = scaler.fit_transform(X_train_res)
X_test_scaled = scaler.transform(X_test)

# 5. Algorithms
log_reg = LogisticRegression(max_iter=2000, multi_class="multinomial")
rf = RandomForestClassifier(n_estimators=200, random_state=42)

log_reg.fit(X_train_res_scaled, y_train_res)
rf.fit(X_train_res, y_train_res)  # trees don't need scaling

def evaluate_model(name, model, X_te):
    y_pred = model.predict(X_te)
    acc = accuracy_score(y_test, y_pred)
    cm = confusion_matrix(y_test, y_pred)
    print(f"\n{name}")
    print("Accuracy:", acc)
    print("Confusion Matrix:\n", cm)
    print("Classification report:\n",
          classification_report(y_test, y_pred, target_names=class_names))

evaluate_model("Logistic Regression", log_reg, X_test_scaled)
evaluate_model("Random Forest", rf, X_test)

# In report:
# - Show class counts (np.bincount(y))
# - Show confusion matrix and per-class precision/recall/F1.
# - Compare which model gives higher per-class F1 and has fewer misclassifications.
